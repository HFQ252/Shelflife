<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>商品保质期临期提醒系统</title>
    <!-- <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/css/bootstrap.min.css" rel="stylesheet"> -->
    <link href="public/css/bootstrap.min.css" rel="stylesheet">
    <!-- 添加Bootstrap Icons -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"> -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css">
    <style>
        /* 原有样式保持不变，只添加新样式 */
        
        /* 新增样式 */
        .global-alert {
            z-index: 1060;
        }
        
        /* 刷新按钮样式 */
        .refresh-btn {
            position: absolute;
            right: 15px;
            top: 10px;
        }
        
        .card-header {
            position: relative;
        }
        
        /* 输入框验证样式 */
        .is-valid {
            border-color: #198754 !important;
        }
        
        .is-invalid {
            border-color: #dc3545 !important;
        }
        
        /* 表格行悬停效果 */
        .table-hover tbody tr:hover {
            background-color: rgba(0, 0, 0, 0.075);
        }
        
        /* 移动端优化 */
        @media (max-width: 768px) {
            .table-responsive {
                font-size: 0.85rem;
            }
            
            .btn-sm {
                padding: 0.2rem 0.4rem;
                font-size: 0.75rem;
            }
            
            .location-badge {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<!-- 在index.html的</body>标签前，修改这个script部分 -->
<script>
  // 使这些函数在全局可访问，供表格中的按钮调用
  window.showDeleteConfirm = showDeleteConfirm;
  window.showEditModal = showEditModal;
  window.confirmDuplicate = confirmDuplicate;
  window.cancelDuplicate = cancelDuplicate;
  window.switchToAddProductTab = switchToAddProductTab; // 新增
  
  // 页面加载完成后初始化
  document.addEventListener('DOMContentLoaded', function() {
    // 添加刷新按钮事件监听
    document.querySelectorAll('.refresh-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const tableType = this.dataset.table;
        switch(tableType) {
          case 'expiring':
            renderExpiringTable();
            break;
          case 'all':
            renderAllTable();
            break;
          case 'database':
            renderProductDatabaseTable();
            break;
        }
        showAlert('表格已刷新', 'info');
      });
    });
    
    // 添加表单验证样式
    document.querySelectorAll('input[required]').forEach(input => {
      input.addEventListener('blur', function() {
        if (this.value.trim() === '') {
          this.classList.remove('is-valid');
          this.classList.add('is-invalid');
        } else {
          this.classList.remove('is-invalid');
          this.classList.add('is-valid');
        }
      });
    });
    
    // 添加键盘快捷键支持
    document.addEventListener('keydown', function(e) {
      // Ctrl+R 刷新当前表格
      if (e.ctrlKey && e.key === 'r') {
        e.preventDefault();
        const activeTab = document.querySelector('.nav-link.active').id;
        switch(activeTab) {
          case 'expiring-tab':
            renderExpiringTable();
            showAlert('临期商品列表已刷新', 'info');
            break;
          case 'all-tab':
            renderAllTable();
            showAlert('所有商品列表已刷新', 'info');
            break;
          case 'add-tab':
            renderProductDatabaseTable();
            showAlert('商品数据库已刷新', 'info');
            break;
        }
      }
    });
  });
</script>
<body>
    <div class="container">
        <h1 class="text-center my-3">商品保质期临期提醒系统</h1>
        
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab">
                    <i class="bi bi-search me-1"></i>商品查询
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="expiring-tab" data-bs-toggle="tab" data-bs-target="#expiring" type="button" role="tab">
                    <i class="bi bi-exclamation-triangle me-1"></i>临期商品
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab">
                    <i class="bi bi-list-ul me-1"></i>所有商品
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="add-tab" data-bs-toggle="tab" data-bs-target="#add" type="button" role="tab">
                    <i class="bi bi-plus-circle me-1"></i>新增商品
                </button>
            </li>
        </ul>
        
        <div class="tab-content" id="myTabContent">
            <!-- 商品查询标签页 -->
            <div class="tab-pane fade show active" id="home" role="tabpanel">
                <div class="card mb-3">
                    <div class="card-header bg-primary text-white py-2">
                        <h5 class="mb-0"><i class="bi bi-box-seam me-1"></i>添加商品到库存</h5>
                        <small class="opacity-75">输入5位SKU编码后自动匹配商品信息</small>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-12 col-md-6">
                                <label for="skuInput" class="form-label">商品SKU编码 <span class="text-danger">*</span></label>
                                <input type="tel" class="form-control" id="skuInput" 
                                       placeholder="输入5位SKU编码" 
                                       maxlength="5"
                                       pattern="[A-Za-z0-9]{5}"
                                       required>
                                <div class="form-text">请输入5位字母或数字组合的SKU编码</div>
                            </div>
                            <div class="col-12 col-md-6">
                                <label for="productName" class="form-label">商品名称</label>
                                <input type="text" class="form-control" id="productName" readonly>
                            </div>
                            <div class="col-6 col-md-4">
                                <label for="shelfLife" class="form-label">保质期(天)</label>
                                <input type="number" class="form-control" id="shelfLife" readonly>
                            </div>
                            <div class="col-6 col-md-4">
                                <label for="reminderDays" class="form-label">临期提醒(天)</label>
                                <input type="number" class="form-control" id="reminderDays" readonly>
                            </div>
                            <div class="col-12 col-md-4">
                                <label for="productionDate" class="form-label">生产日期 <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="productionDate" 
                                       disabled 
                                       required
                                       title="请先输入有效的SKU编码">
                                <div class="form-text">选择商品的生产日期</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-3">
                    <div class="card-header bg-success text-white py-2">
                        <h5 class="mb-0"><i class="bi bi-calculator me-1"></i>计算结果</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-12 col-md-4">
                                <label class="form-label">到期日期</label>
                                <div class="form-control result-box" id="expiryDate">-</div>
                            </div>
                            <div class="col-12 col-md-4">
                                <label class="form-label">提醒日期</label>
                                <div class="form-control result-box" id="reminderDate">-</div>
                            </div>
                            <div class="col-12 col-md-4">
                                <label class="form-label">剩余天数</label>
                                <div class="form-control result-box" id="remainingDays">-</div>
                            </div>
                        </div>
                        <div class="mt-4" id="statusIndicator"></div>
                    </div>
                </div>
                
                <div class="d-grid gap-2">
                    <button class="btn btn-primary btn-lg" id="saveBtn">
                        <i class="bi bi-save me-1"></i>保存到库存
                    </button>
                </div>
                
                <div class="alert alert-info mt-3 mb-0">
                    <i class="bi bi-info-circle me-1"></i>
                    <strong>操作提示：</strong> 
                    输入SKU编码后会自动查询商品信息，选择生产日期后系统会自动计算到期日期和剩余天数。
                    相同SKU和相同生产日期的商品会被检测为重复记录。
                </div>
            </div>
            
            <!-- 临期商品标签页 -->
            <div class="tab-pane fade" id="expiring" role="tabpanel">
                <div class="card">
                    <div class="card-header bg-warning text-white py-2">
                        <h5 class="mb-0"><i class="bi bi-exclamation-triangle me-1"></i>临期/过期商品列表</h5>
                        <button class="btn btn-sm btn-light refresh-btn" data-table="expiring">
                            <i class="bi bi-arrow-clockwise"></i> 刷新
                        </button>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover mb-0">
                                <thead class="table-warning">
                                    <tr>
                                        <th>SKU</th>
                                        <th>商品名称</th>
                                        <th>库位</th>
                                        <th>生产日期</th>
                                        <th>到期日期</th>
                                        <th>剩余天数</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="expiringTable">
                                    <!-- 数据将通过JavaScript动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="alert alert-warning mt-3 mb-0">
                    <i class="bi bi-exclamation-triangle me-1"></i>
                    此列表显示已过期或即将过期的商品，请及时处理。
                </div>
            </div>
            
            <!-- 所有商品标签页 -->
            <div class="tab-pane fade" id="all" role="tabpanel">
                <div class="card">
                    <div class="card-header bg-info text-white py-2">
                        <h5 class="mb-0"><i class="bi bi-list-ul me-1"></i>库存商品列表</h5>
                        <small class="opacity-75">按剩余保质期排序（从少到多）</small>
                        <button class="btn btn-sm btn-light refresh-btn" data-table="all">
                            <i class="bi bi-arrow-clockwise"></i> 刷新
                        </button>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover mb-0">
                                <thead class="table-info">
                                    <tr>
                                        <th>SKU</th>
                                        <th>商品名称</th>
                                        <th>库位</th>
                                        <th>生产日期</th>
                                        <th>到期日期</th>
                                        <th>剩余天数</th>
                                        <th>状态</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="allTable">
                                    <!-- 数据将通过JavaScript动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 新增商品标签页 -->
            <div class="tab-pane fade" id="add" role="tabpanel">
                <div class="card">
                    <div class="card-header bg-secondary text-white py-2">
                        <h5 class="mb-0"><i class="bi bi-plus-circle me-1"></i>新增商品到数据库</h5>
                        <small class="opacity-75">添加新商品的基本信息</small>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-12 col-md-6">
                                <label for="newSku" class="form-label">商品SKU编码 <span class="text-danger">*</span></label>
                                <input type="tel" class="form-control" id="newSku" 
                                       placeholder="输入5位SKU编码" 
                                       maxlength="5"
                                       pattern="[A-Za-z0-9]{5}"
                                       required>
                                <div class="form-text">5位字母或数字组合，不可重复</div>
                            </div>
                            <div class="col-12 col-md-6">
                                <label for="newName" class="form-label">商品名称 <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="newName" 
                                       placeholder="输入商品名称" 
                                       required>
                            </div>
                            <div class="col-12 col-md-6">
                                <label for="newShelfLife" class="form-label">保质期(天) <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="newShelfLife" 
                                       placeholder="输入保质期天数" 
                                       min="1" 
                                       required>
                            </div>
                            <div class="col-12 col-md-6">
                                <label for="newReminderDays" class="form-label">临期提醒(天) <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="newReminderDays" 
                                       placeholder="输入提前提醒天数" 
                                       min="0" 
                                       required>
                                <div class="form-text">0表示不提醒</div>
                            </div>
                            <div class="col-12 col-md-6">
                                <label for="newLocation" class="form-label">存放库位 <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="newLocation" 
                                       placeholder="输入商品存放位置" 
                                       required>
                            </div>
                            <div class="col-12">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-primary btn-lg" id="addProductBtn">
                                        <i class="bi bi-check-circle me-1"></i>添加到商品数据库
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header bg-light py-2">
                        <h5 class="mb-0"><i class="bi bi-database me-1"></i>商品数据库</h5>
                        <button class="btn btn-sm btn-outline-secondary refresh-btn" data-table="database">
                            <i class="bi bi-arrow-clockwise"></i> 刷新
                        </button>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover mb-0">
                                <thead>
                                    <tr>
                                        <th>SKU</th>
                                        <th>商品名称</th>
                                        <th>保质期(天)</th>
                                        <th>临期提醒(天)</th>
                                        <th>库位</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="productDatabaseTable">
                                    <!-- 数据将通过JavaScript动态加载 -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 删除确认模态框 -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="modalTitle"><i class="bi bi-exclamation-triangle"></i> 确认删除</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modalBody">
                    确定要删除这条记录吗？
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        <i class="bi bi-trash"></i> 确认删除
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 重复记录确认模态框 -->
    <div class="modal fade" id="duplicateModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-warning">
                    <h5 class="modal-title"><i class="bi bi-exclamation-triangle"></i> 发现重复记录</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="duplicateBody">
                    <!-- 内容由JavaScript动态填充 -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="cancelDuplicate()">
                        <i class="bi bi-x-circle"></i> 取消
                    </button>
                    <button type="button" class="btn btn-warning" onclick="confirmDuplicate()">
                        <i class="bi bi-plus-circle"></i> 继续添加
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 编辑商品模态框 -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-pencil"></i> 编辑商品信息</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editSku" class="form-label">商品SKU</label>
                        <input type="text" class="form-control" id="editSku" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="editName" class="form-label">商品名称 <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="editName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editShelfLife" class="form-label">保质期(天) <span class="text-danger">*</span></label>
                        <input type="number" class="form-control" id="editShelfLife" min="1" required>
                    </div>
                    <div class="mb-3">
                        <label for="editReminderDays" class="form-label">临期提醒(天) <span class="text-danger">*</span></label>
                        <input type="number" class="form-control" id="editReminderDays" min="0" required>
                    </div>
                    <div class="mb-3">
                        <label for="editLocation" class="form-label">库位 <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="editLocation" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="saveEditBtn">
                        <i class="bi bi-check-circle"></i> 保存更改
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script> -->
    <script src="https://cdn.bootcdn.net/ajax/libs/bootstrap/5.2.3/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
    
    <!-- 全局函数声明，供按钮调用 -->
    <script>
        // 使这些函数在全局可访问，供表格中的按钮调用
        window.showDeleteConfirm = showDeleteConfirm;
        window.showEditModal = showEditModal;
        window.confirmDuplicate = confirmDuplicate;
        window.cancelDuplicate = cancelDuplicate;
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 添加刷新按钮事件监听
            document.querySelectorAll('.refresh-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tableType = this.dataset.table;
                    switch(tableType) {
                        case 'expiring':
                            renderExpiringTable();
                            break;
                        case 'all':
                            renderAllTable();
                            break;
                        case 'database':
                            renderProductDatabaseTable();
                            break;
                    }
                    showAlert('表格已刷新', 'info');
                });
            });
            
            // 添加表单验证样式
            document.querySelectorAll('input[required]').forEach(input => {
                input.addEventListener('blur', function() {
                    if (this.value.trim() === '') {
                        this.classList.remove('is-valid');
                        this.classList.add('is-invalid');
                    } else {
                        this.classList.remove('is-invalid');
                        this.classList.add('is-valid');
                    }
                });
            });
            
            // 添加键盘快捷键支持
            document.addEventListener('keydown', function(e) {
                // Ctrl+R 刷新当前表格
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    const activeTab = document.querySelector('.nav-link.active').id;
                    switch(activeTab) {
                        case 'expiring-tab':
                            renderExpiringTable();
                            showAlert('临期商品列表已刷新', 'info');
                            break;
                        case 'all-tab':
                            renderAllTable();
                            showAlert('所有商品列表已刷新', 'info');
                            break;
                        case 'add-tab':
                            renderProductDatabaseTable();
                            showAlert('商品数据库已刷新', 'info');
                            break;
                    }
                }
            });
        });
    </script>
</body>
</html>